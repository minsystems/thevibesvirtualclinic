{% extends "base.html" %}
{% block title %}specialties{% endblock %}


{% block header-content %}
    {{speciality_category.name}}
{% endblock header-content %}

{% block header-description %}
    {{ speciality_category.description }}
{% endblock header-description %}


{% block content %}


    <section class="section bg-light">
      <div class="container">
        <div class="row">
        {% for speciality in specialities %}
          <div class="col-md-3 element-animate">
            <div class="media d-block media-custom text-center">
              <img src="{{ speciality.check_image_url }}" alt="{{ speciality.name }}" class="img-fluid">
              <div class="media-body text-center">
                  {% if request.user.is_authenticated %}
                    <h3 class="mt-0 text-black">â‚¦{{ speciality.price }}</h3>
                  {% else %}
                      <h3>Please <a href="{% url 'account-url:login' %}">login</a> to access this service</h3>
                  {% endif %}
                <p>{{ speciality.name }}</p>
               {% if request.user.is_authenticated %}
                <p>
                  <form>
                      <script src="https://js.paystack.co/v1/inline.js"></script>
                      <button class="btn btn-primary btn-sm" type="button" onclick="payWithPaystack()">Make Payment For Consultation</button>
                  </form>
                  <script>
                      function payWithPaystack(){
                        let fee = parseInt({{ speciality.price|safe }});
                        let finalFee = 100 * fee;
                        var handler = PaystackPop.setup({
                          key: 'pk_live_62ad848d9d919a21a100dd6fef0bf6c457a70683',
                          email: '{{ request.user.email|safe }}',
                          amount: finalFee,
                          ref: ''+Math.floor((Math.random() * 1000000000) + 1), // generates a pseudo-unique reference. Please replace with a reference you generated. Or remove the line entirely so our API will generate one for you
                          metadata: {
                             custom_fields: [
                                {
                                    display_name: "{{ request.user|safe }}",
                                    variable_name: "{{ request.user|safe }}",
                                    value: "+2348160527819"
                                }
                             ]
                          },
                          callback: function(response){
                              alert('success. transaction ref is ' + response.reference + '/n please copy this Reference number to a safe place /n and contact our agent using the Reference number as Evidence of payment');
                          },
                          onClose: function(){
                              alert('window closed');
                          }
                        });
                        handler.openIframe();
                      }
                    </script>
                </p>
              {% endif %}
              </div>
            </div>
          </div>
        {% if forloop.counter|divisibleby:4 %}
        </div>

        <div class="row mb-5">
        {% endif %}
        {% empty %}
                <div class="row justify-content-center mb-3 element-animate">
                  <div class="col-md-8 text-center mb-3">
                    <h2 class="text-uppercase heading border-bottom mb-4">{{speciality_category.name}}</h2>
                    <p class="mb-0 lead">Currently we have no services for {{speciality_category.name}}</p>
                  </div>
                </div>
        {% endfor %}
        </div>

      </div>
    </section>
{% endblock %}